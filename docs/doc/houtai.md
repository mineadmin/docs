# 后端文档

## 使用注解列表

#### 控制器类路由注解 @Controller 

>该注解为Hyperf框架官方路由注解，用于定义控制器类路由

使用范围
 - Class

#### 控制器类方法路由注解

>该系列注解为Hyperf框架官方路由注解，用于定义控制器类路由

- `@PostMapping`   POST请求路由注解
- `@GetMapping`    GET请求路由注解
- `@DeleteMapping` DELETE请求路由注解
- `@PutMapping`    PUT请求路由注解

使用范围
- Method

上面例子请求index的完整路由即为：`demo/index`

#### 身份验证注解 @Auth

> 用户必须登录后才可以访问某个接口

使用范围
- Class   使用再类上面，对该类的所有方法有效
- Method  使用方法上面只对该方法有效

#### 权限验证注解 @Permission

> 只允许有某接口权限的用户访问 （会附带对身份验证）

使用范围
- Method  只对方法有效

参数说明
> 要验证的权限标识代码，可在 `菜单管理` 查询菜单的权限标识代码


#### 操作日志注解 @OperationLog

> 使用后会记录用户在后台请求某接口的参数、返回值、用户信息等

使用范围
- Method  只对方法有效


#### 数据库事务注解 @Transaction

> 使用后会自动启动事务、提交。执行失败自动回滚。

使用范围
- Method  只对方法有效


## 数据权限
在实际开发中，需要设置用户只能查看哪些部门的数据，这种情况一般称为数据权限。
例如对于销售，财务的数据，它们是非常敏感的，因此要求对数据权限进行控制，
对于基于集团性的应用系统而言，就更多需要控制好各自公司的数据了。
如设置只能看本公司、或者本部门的数据，对于特殊的领导，可能需要跨部门的数据，
因此程序不能硬编码那个领导该访问哪些数据，需要进行后台的权限和数据权限的控制。

:::tip
超级管理员 `superAdmin` 默认为所有访问权限和数据权限，其角色同样如此。
:::

> 数据权限设置在角色管理里面

:::warning
若想使用数据权限，MineAdmin自带的数据表请忽略。
但自建的数据表都需要有 `created_by` 字段，且类型为`bigint`
:::

:::tip
使用方法
:::

MineAdmin 通过 `Builder` 类的 `macro` 方法扩展出了一个方法 `userDataScope()`。

不管你是用 查询构造器 方式还是使用 模型查询，都可以使用该方法
```php
// 查询构造器使用
Db::table('user')->userDataScope()->get();

// 模型使用
User::query()->userDataScope()->get();
```

这样，查询出的数据会自动设置该用户所允许查看的数据了。

:::tip
如果使用系统封装好的curd，那么系统已经默认调用该方法了。
:::