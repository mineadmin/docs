# 版本更新记录
## 0.5.2
#### 更新日期：2022-01-13
#### PHP最低版本要求变更为8.0，不再支持7.4及以下版本
#### 0.5.1以下版本小伙伴们请酌情升级
- [增强] 更换依赖phper666/jwt-auth到xmo/jwt-auth，从而支持了PHP8及以上版本

- [修复] 降低element plus版本到1.2.0-beta.3，解决前端UI弹框的确定按钮不显示文字问题
- [修复] 接口文档里面获取 AccessToken 报错问题

从老版本升级到最新版本后，请执行 `composer install` 命令，更新依赖。

## 0.5.1
#### 更新日期：2022-01-11
- [升级] 升级到SCUI最新的稳定版本

- [修复] 修复队列重试时，数据套娃
- [修复] 上传目录删除失败问题
- [修复] 记录操作日志逻辑bug修复

- [优化] 优化队列未开启时推送消息提示信息

升级后，请执行 `yarn` 命令完成前端依赖升级更新

## 0.5.0
#### 更新日期：2022-01-10
- [新增] RabbitMQ队列功能（默认未开启，安装rabbitMQ后，请看最下面的开启教程）
- [新增] 新增队列日志管理
- [新增] 新增发布公告和通知功能
- [新增] 新增消息功能及消息中心
- [新增] websocket消息服务器
- [新增] 适配SCUI的资源选择组件
- [新增] 新增用户选择器组件
- [新增] 表设计器新增id是否生成雪花ID

- [修复] 生成模型判断数据表与模块是否有关系
- [修复] value() 方法返回值类型删除
- [修复] 某些页面图标不显示问题
- [修复] 删除上传目录查询逻辑
- [修复] 部分页面因调整request.js返回code造成操作无响应问题
- [修复] 修复头像不显示问题，优化上传
- [修复] 修复部门列表不显示回收站按钮
- [修复] 修复树表代码生成器bug
- [修复] 修改数据权限的自定义权限bug

- [优化] 前端新增.env环境变量
- [优化] Class类型定时任务增加返回结果记录日志里
- [优化] 代码生成vue目录名调整
- [优化] 定时任务日志排序
- [优化] 调用数据权限缺少用户id时，抛出异常
- [优化] 代码生成器功能
- [优化] 升级到hyperf最新版
- [优化] 对部分数据表结构调整
- [优化] 滑块验证器视觉上的问题

老版本升级请按以下操作进行：
1、进入到后端根目录，首先执行 composer install 命令，安装新依赖。
2、在后端根目录执行 php bin/hyperf.php mine:update 命令，执行升级SQL语句
3、若使用队列功能，请在后台.env文件增加以下内容：

AMQP_HOST = 127.0.0.1
AMQP_PORT = 5672
AMQP_USER = guest
AMQP_PASSWORD = guest
AMQP_VHOST = /
AMQP_ENABLE = true
4、开启rabbitMQ的生产和消费进程（请确保已安装rabbitMQ）
打开 App\System\Queue\Consumer\MessageConsumer.php
搜索文件 把 #Consumer 替换成 @Consumer

打开 App\System\Queue\Producer\MessageProducer.php
搜索文件 把 #Producer 替换成 @Producer


## 0.4.2
#### 更新日期：2021-12-17
- [修复] 代码生成带表前缀，无法生成模型问题。
- [修复] 部门和菜单数据权限问题
- [修复] 前端 viewImage 在某些情况下出现变量未定义问题

- [优化] 生成模型判断数据表与模块是否有关系
## 0.4.1
#### 更新日期：2021-12-16
- [修复] 因去掉业务级拦截器造成部分页面没有提示问题
- [修复] 模型 $cats 类型转换问题
- [修复] 数据权限选择自定义部门后更换其他类型前端报错问题
- [修复] 导入组件使用姿势错误导致权限失效
- [修复] 前端标题有时候会undefined，感谢 zio 贡献的代码

- [优化] 更换登录背景
- [优化] 应用修改app_secret时，弹出确认框，感谢 7788 贡献的代码
- [优化] 生成代码 code 修改为短业务名
- [优化] 用户选择角色过滤掉超管角色
- [优化] 数据库事务注解抛出异常由NormalStatusException改为MineException

- [新增] 操作日志注解新增直接传入菜单名称
- [新增] 新增删除缓存注解，在请求完成后执行。

## 0.4.0
#### 更新日期：2021-12-07
新增API授权管理

新版本增加了一套api解决方案。

可自行在后台创建API，对API的请求和响应数据进行控制。可以对API进行最高 oauth2.0 形式的授权

api 可以进行分组管理，对api进行 app级别的接口绑定，复用等管理。

此外还有api文档自动生成、模拟请求api功能


- [修复] 修复代码生成器选择生成到模块后，无法预览代码的情况
- [修复] 修复城市选择器padding问题
- [修复] 修复回收站菜单删除bug
- [修复] 优化导入删除临时文件逻辑
- [修复] 一些地方文字描述错误

- [优化] 附件保存数据库地址改为相对地址（请自行批量替换system_uploadfile表的url字段，把前面的url地址给去掉）
- [优化] 城市联级选择器改为联级单层选择，新增城市codeToCity方法
- [优化] 升级SCUI的版本，图标由font字体改为svg文件
- [优化] mapper接收排序参数以及排序逻辑优化
- [优化] 登录监听客户端操作系统、浏览器等useragent优化
- [优化] 整理优化现由表结构
- [优化] 优化导入删除临时文件逻辑

- [新增] 城市联级和城市下拉选择器，可设置返回code或城市名
- [新增] ORM的macro 新增 andFilterWhere 和 orFilterWhere 方法
- [新增] service 和 mapper层新增属性注入方法，注入后可以 this方式访问数据库字段（需手动注入）- [新增]service新增批量保存数据方法batchSave(arraycollects)
- [新增] 新增monaco编辑器组件，可用于编辑json
- [新增] 新增业务级自定义函数库 common/common.php
- [新增] mapper获取列表类数据新增$isScope参数，可控制是否调用数据权限
- [新增] 新增 mine:gen-jwt --jwtSecret=密钥名称 命令，可生成其他场景的jwt验证密钥

老版本升级请按以下操作进行：
- 1、进入到前端根目录，在命令行执行 yarn install 命令
- 2、进入到后端根目录，首先执行 composer install 命令，安装新依赖。
- 3、在后端根目录执行 php bin/hyperf.php mine:update 命令，执行升级SQL语句
- 4、在后端根目录执行 php bin/hyperf.php mine:gen-jwt --jwtSecret=JWT_API_SECRET 生成 API 的 jwt 密钥
- 5、下载SQL附件，更新菜单图标 （如有表前缀，请自定打开SQL文件替换）
- 6、更新缓存

## 0.3.10
#### 更新日期：2021-11-09
- [修复] 附件管理分页错误
- [修复] 上传图片格式化大小错误
- [修复] 删除部门，如果有子级情况下，会跳过删除，但提示删除成功的错误
- [修复] 通过key获取配置方法调用错误
- [修复] 非统计页面路由错误，并优化图标随机色块
- [修复] 一些地方文字描述错误

- [优化] Excel导出数据大数字避免科学计数法
- [优化] 后台个性化设置重新优化，支持保存到服务器端
- [优化] 经典模式侧边栏菜单改为手风琴效果
- [优化] 优化验证码缓存key生成
- [优化] 部门、岗位、字典状态修改功能完善
- [优化] 事务注解增加重试参数

- [新增] 城市联级和城市下拉选择器，可设置返回code或城市名
- [新增] 后端和前端各增加验证码方式开关
- [新增] 滑块验证码，支持拼图、旋转图片验证等方式
- [新增] 登录新增滑块验证码（前端验证）
- [新增] 定时任务新增表达式生成器

PS：
前端需要重新安装依赖，请执行 yarn install 命令

服务启动后，请新开一个终端运行 php bin/hyperf.php mine:update 命令，升级SQL

若更新后登录遇到 code字段是必须的 提示，请修改以下文件临时修复这个bug：

打开 mine-ui/src/views/userCenter/login.vue 转到第215行：
```js
if (! this.ruleForm.code && this.verifyType === '0') this.ruleForm.code = 'code'
```
修改为
```js
if (! this.ruleForm.code && this.verifyType !== '1') this.ruleForm.code = 'code'
```

## 0.3.9
#### 更新日期：2021-11-05
- [修复] 修复获取网络图片大小不准确问题
- [修复] 修复其他已知问题

- [优化] 更新SCUI的路由扁平化，并匹配合适系统的方式优化路由
- [优化] 生成代码支持生成到模块（仅限后端文件），前端和sql还是以压缩包形式下载
- [优化] 生成模型防止表名称不符合规则导致超时问题
- [优化] 修改操作记录表router字段长度为500
- [优化] 优化系统更新命令 mine:update 支持修改表结构
- [优化] 后台个性设置保存到本地localstorage

- [新增] redis锁
- [新增] 防止重复提交注解 @Resubmit

PS：
更新版本后，请重新运行 composer install 命令安装依赖
服务启动后，请新开一个端口运行 php bin/hyperf.php mine:update 命令，升级SQL


## 0.3.8
#### 更新日期：2021-11-02
- [修复] 角色修改时，修复没有去除主键key，导致在恶意情况下会改变主键值的bug
- [修复] 修复LoginUser类的getId方法返回值类型错误的问题

- [优化] 提高程序健壮性，对增删改查模型进行判断，以防出现null调用方法
- [优化] 更换登录界面图片
- [优化] 代码版权注释完善

- [新增] mapper类型新增常用方法
- [新增] 图片上传新增保存和使用网络图片
- [新增] 新增延迟队列实现，感谢mike贡献的代码。

## 0.3.7
#### 更新日期：2021-10-28
- [修复] 修复因删除MethodNotAllowExceptionHandler类，但配置文件没有删掉配置造成的报错。

- [优化] 更换新的验证码组件，返回验证码方式由base64改为图片地址
- [优化] 前端增加全局配置请求超时时间项，在 config/index.js 的TIMEOUT可以设置超时时间
- [优化] 优化缓存监控界面功能

PS: 请重新执行 composer install

## 0.3.6
#### 更新日期：2021-10-27
- [优化] 权限菜单：可以选择删除按钮菜单

- [新增] 开发工具菜单前端可控制，详细查看 config/index.js 的APP_MODE说明
- [新增] 新增多个字典获取方法，this.getDicts(- ['字典1', '字典2'])
- [新增] 新增缓存监控功能，可以查看redis信息和当前缓存列表

PS：更新此版本后，请执行更新命令完成SQL升级 php bin/hyperf.php mine:update

## 0.3.5
#### 更新日期：2021-10-25
- [优化] 用户编辑增加头像修改
- [优化] 登录日志和操作日志添加默认排序
- [优化] 前后端底层支持多语言
- [优化] 后端多语言包，目前支持中文和英文，前端也将慢慢开始优化

- [新增] 后端新增多语言函数 t()
- [新增] 前端向后端请求header里增加语言参数


## 0.3.4
#### 更新日期：2021-10-23
- [修复] 修复已知问题及bug

- [优化] 更新最新版的SCUI
- [优化] 附件管理界面形式更改
- [优化] 使用新版的SCUI登录界面，后续还会继续优化。
- [优化] 完善资源选择管理器
- [优化] 更新依赖

- [新增] 组件演示
- [新增] 锁屏功能

PS:此版本前端需要删除老的node_modules，重新执行 yarn 或者 npm install 安装依赖

## 0.3.3
#### 更新日期：2021-10-20
- [修复] 修复字典添加完成后列表跳到第一个类型的问题
- [修复] 修复其他已知问题

- [优化] 部门编辑的时候，禁止选择上级部门为本部门
- [优化] 修改默认主题颜色
- [优化] 附件管理增强，添加上传按钮，侧边添加目录管理，可以新建、删除目录。
- [优化] 启动服务提示文字修改，增加webscoket服务。PS:可以自己关闭。
- [优化] maTable 新增两个回调方法，支持原生属性绑定
- [优化] 更新依赖

- [新增] 资源文件选择器，可以选择已上传的图片等。后续功能继续优化增强
- [新增] 添加助手函数库文件functions.php

## 0.3.1
#### 更新日期：2021-10-09
紧急修复一个bug

## 0.3.1
#### 更新日期：2021-10-08
- [修复] 修复代码生成器一些问题
- [修复] 修复系统路由载入错误导致xxx.js报错

- [优化] 更新最新的SCUI版本

ps：前端更新到最新的SCUI版本跨度较大，含有小部分破坏性更新，更新后请删除node_module，重新安装前端依赖

## 0.3.0
#### 更新日期：2021-09-15
- [修复] 修复代码生成器已知问题
- [修复] 修复系统监控在mac下500错误问题

- [优化] 用户多选删除，过滤掉超级管理员
- [优化] 去掉登录页面方块动画
- [优化] 在线表设计器支持数字和下划线
- [优化] 代码生成器兼容hyperf创建模型以s结尾的问题
- [优化] 定时任务查看日志抽屉大小调整
- [优化] 用户数据权限完善优化

- [新增] 导入和导出功能
- [新增] 导入导出相关建立的DTO类（data to object)的注解
- [新增] 数据库事务注解
- [新增] 用户管理增加导入和导出功能

## 0.2
#### 更新日期：2021-09-01
- 代码生成器完善

## 0.1
#### 更新日期：2021-08-15
- 第一个版本发布