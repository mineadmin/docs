# 代码生成器

:::tip CRUD简介
我们在项目开始就规划了代码生成器，现在配合CRUD组件，将更容易完成开发操作，下面介绍代码生成器使用方法。
:::

## 准备工作
- 建立好数据表，请遵循数据表的 [[设计规则]](/further/mustLearn/db.md)
- 数据表注释和字段注释完善

## 载入数据表
- 进入后台，点击 [ `工具` > `代码生成器` ]，打开代码生成器页面

<img src="https://s1.ax1x.com/2022/08/21/vyDlsx.png" />

- 点击 `载入数据表`，选择已创建好的数据表，点击弹窗的 `确定` 按钮

<img src="https://s1.ax1x.com/2022/08/21/vyDJoD.png" />

## 编辑生成信息
:::tip
载入数据表后，并不可以直接生成代码，还需要对生成信息进行设置
:::
<img src="https://s1.ax1x.com/2022/08/21/vyD0yt.png" />

### 基本信息配置
<img src="https://s1.ax1x.com/2022/08/21/vyDXlR.png" />

#### 配置信息注意事项和说明
- 所属模块请注意自己的表名称是否匹配模块，如不熟悉请阅读数据表 [[设计规则]](/further/mustLearn/db.md)
- 所属菜单可以不选择，默认则为顶级菜单，一般看自己业务情况，如果业务复杂，分了很多功能来管理；
则可以手动建立一个顶级菜单，然后所生成的功能都选择这个顶级菜单
- 生成类型一般都可选择单表，如像系统的 `菜单管理` 和 `部门管理` 这种树形数据结构，可选择树形增删改查。
但树表要包括`树表的ID`，`树表的父id` 和 `树的名称`
- 包名是在 `Controller` 目录下允许再次建立目录以区分功能模块，把相同功能的控制器文件管理在同类的目录里
- 生成方式建议 `选择压缩包` 下载，生成到目录会覆盖文件，如果之前生成过，再次点击生成可能会造成文件被替换
- 构建菜单建议选择 `不构建菜单`，因为点击生成后，每次都会对菜单表插入一次数据，可能会造成菜单的 `code` 重复；
自己手动导入到数据表也并不麻烦。

### 字段配置
<img src="https://s1.ax1x.com/2022/08/21/vyrX4g.png" />

#### 字段配置注意事项和说明
- 字段描述为生成后的表格列表名称和新增、编辑的字段名称，一般要精简一下
- 必填：勾选后前端和后端则会验证该字段是否填写
- 插入：勾选后在新增界面会显示该字段
- 编辑：勾选后在编辑界面会显示该字段
- 列表：勾选后在列表管理界面会显示该字段
- 查询：勾选后会在列表搜索栏里显示搜索该字段项
- 查询方式：选择相应的SQL搜索数据方式，如果 `查询` 未勾选，并不会生成相应配置
- 页面控件：列表搜索、新增和编辑显示相对应的组件，部分组件可在点击后面的 `设置` ，对该组件进行调整
- 数据字典：可在页面控件为：下拉框、复选框、单选框和穿梭框的情况下选择，组件配合数据字典，和重复使用一些固定的数据；
在列表、新增和编辑自动配置对应的数据，同时，列表的数据会翻译为字典的标签，这个功能非常常用，请多加利用。
- 允许角色`（目前未开发）`：配置该字段可以允许哪些角色可以看到，用户没有允许的角色，则看不到该数据

### 菜单配置
<img src="https://s1.ax1x.com/2022/08/21/vyrx3j.png" />

#### 菜单配置注意事项和说明
:::tip
回收站列表项包含三个接口：回收站列表、恢复、真实删除。

建议这些菜单都勾选上，以免后续需要时还要再重新生成。暂时用不到，不用理会即可。
:::

### 关联配置
<img src="https://s1.ax1x.com/2022/08/21/vysA5F.png" />

#### 关联配置注意事项和说明
:::tip
关联配置目前只在模型里生成了定义关联的方法，在实际调用中并未使用，若需要还需自行调用定义的方法。
:::

系统使用的 `Hyperf` 框架，而 `Hyperf` 使用的是 `Laravel` 框架的 `Eloquent ORM` 包；

具体定义方法和使用方法请看相关文档 [[Hyperf模型章节]](https://hyperf.wiki/2.2/#/zh-cn/db/model)

## 预览代码
:::tip 
如果在生成代码后，再次编辑了生成信息，可在预览代码界面直接复制代码
:::
<img src="https://s1.ax1x.com/2022/08/21/vyynJg.png" />

## 生成代码及使用
- 在 `代码生成器` 的列表页面，点击 `生成代码` 按钮，系统会向浏览器发送下载数据，接收下载的一个压缩包。
- 压缩包内分为 `php` 目录和 `vue` 目录，分别存放着后端和前端的代码
- 前后端的目录层级都已经在生成过程中设置好

### 导入菜单
- 打开压缩包的 `menu.sql` 文件，复制文件里的所有SQL语句，粘贴到数据库工具内执行SQL。让对应功能的菜单生成

:::warning 提示
如果勾选了构建菜单，则不需要执行这一步
:::
### 使用后端代码
- 打开压缩包的 `php` 目录，复制里面的所有目录和文件
- 打开后端根目录，粘贴进去（如之前生成过，请不要直接粘贴，以免造成之前的文件被覆盖）
- 执行 `composer dump-autoload -o` 命令，清除框架的代理缓存类
- 结束框架进程，重新启动框架

### 使用前端代码
- 打开压缩包的 `vue` 目录，复制里面的所有目录和文件
- 打开后端根目录，粘贴进去（如之前生成过，请不要直接粘贴，以免造成之前的文件被覆盖）
- 鼠标移动到后台右上角的头像，点击 `清除缓存` 更新用户的菜单数据，刷新浏览器，看是否显示新增的菜单
- 点击新增的菜单，看页面是否显示，如果不显示，请重启前端